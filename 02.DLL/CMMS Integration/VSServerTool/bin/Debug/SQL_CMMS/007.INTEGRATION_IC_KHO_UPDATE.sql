CREATE PROC [dbo].[INTEGRATION_IC_KHO_UPDATE]
	@STT int ,
	@MS_KHO NVARCHAR(30) ,
	@TEN_KHO nvarchar(50) ,
	@DIA_CHI nvarchar(100) ,
	@SO_DO nvarchar(255) ,
	@ISIT bit ,
	@MS_CONG_NHAN nvarchar(9) ,
	@NGAY_LOCK NVARCHAR(30) ,
	@GIO_LOCK NVARCHAR(30) ,
	@UNAME nvarchar(50) ,
	@SN_CANH_BAO int ,
	@KHO_DD bit ,
	@MS_KHO_CHINH int ,
	@MS_DON_VI nvarchar(6),
	@INSERT_DATE NVARCHAR(30) ,
	@UPDATE_DATE NVARCHAR(30) ,
	@DA_CHUYEN bit ,
	@NGAY_CHUYEN NVARCHAR(30)
AS

IF @MS_CONG_NHAN = ''
	SET @MS_CONG_NHAN = NULL


IF EXISTS ( SELECT MS_KHO FROM IC_KHO WHERE MS_KHO_INT = @MS_KHO)
	BEGIN
		UPDATE IC_KHO SET TEN_KHO = @TEN_KHO, DIA_CHI = @DIA_CHI, SO_DO = @SO_DO, 
		ISIT = @ISIT, MS_CONG_NHAN = @MS_CONG_NHAN
		WHERE MS_KHO_INT = @MS_KHO 
	
	END
	ELSE
	BEGIN
		--DECLARE @MS_KHO_CMMS INT 
		--SELECT @MS_KHO_CMMS = ISNULL(MAX(MS_KHO),0) + 1  FROM IC_KHO 
		
		INSERT INTO IC_KHO (TEN_KHO, DIA_CHI, SO_DO, ISIT, MS_CONG_NHAN , MS_KHO_INT)
		VALUES(@TEN_KHO, @DIA_CHI, @SO_DO, @ISIT, @MS_CONG_NHAN,@MS_KHO)
	
	END	