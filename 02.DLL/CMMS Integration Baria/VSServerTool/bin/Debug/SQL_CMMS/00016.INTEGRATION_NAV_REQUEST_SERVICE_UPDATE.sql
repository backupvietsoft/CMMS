
IF NOT EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND name = 'INTEGRATION_NAV_REQUEST_SERVICE_UPDATE')
   exec('CREATE PROCEDURE [dbo].[INTEGRATION_NAV_REQUEST_SERVICE_UPDATE] AS BEGIN SET NOCOUNT ON; END')
GO

ALTER PROC [dbo].INTEGRATION_NAV_REQUEST_SERVICE_UPDATE	
	@STT bigint,
	@MS_YEU_CAU nvarchar(20),
	@GL_ACC nvarchar(50),
	@MO_TA_SERVICE nvarchar(255),
	@SER_GROUP_CODE nvarchar(50),	
	@SO_LUONG float,
	@MS_CONG_NHAN nvarchar(9),
	@NGAY_YEU_CAU nvarchar(30),
	@MS_PHIEU_BAO_TRI nvarchar(255),
	@MS_BP_CHIU_PHI int,
	@AMOUNT float,
	@VENDOR_CODE varchar(20),
	@INSERT_DATE nvarchar(30),
	@UPDATE_DATE nvarchar(30),
	@STATUS	nvarchar(1),
	@DA_CHUYEN bit,
	@NGAY_CHUYEN nvarchar(30)
AS

	IF @MS_BP_CHIU_PHI = -1 
		SET @MS_BP_CHIU_PHI = NULL
	IF @AMOUNT = -1 
		SET @AMOUNT = NULL
	IF @VENDOR_CODE = '-1'
		SET @VENDOR_CODE = NULL
		
		
		       
       DECLARE @NGAY_YEU_CAU_CV DATETIME  
       DECLARE @INSERT_DATE_CV DATETIME
       DECLARE @UPDATE_DATE_CV DATETIME
       DECLARE @NGAY_CHUYEN_CV DATETIME
       
		IF ISNULL(@NGAY_YEU_CAU,'') <> '' 
		SET @NGAY_YEU_CAU_CV = CONVERT(DATETIME,@NGAY_YEU_CAU,121)
		IF ISNULL(@INSERT_DATE,'') <> '' 
		SET @INSERT_DATE_CV = CONVERT(DATETIME,@INSERT_DATE,121)
		IF ISNULL(@UPDATE_DATE,'') <> '' 
		SET @UPDATE_DATE_CV = CONVERT(DATETIME,@UPDATE_DATE,121)
		IF ISNULL(@NGAY_CHUYEN,'') <> '' 
		SET @NGAY_CHUYEN_CV = CONVERT(DATETIME,@NGAY_CHUYEN,121)
IF NOT EXISTS (SELECT STT_SYN FROM SYN_NAV_REQUEST_SERVICE_INTEGRATION WHERE STT_SYN = @STT)
BEGIN		
		INSERT INTO SYN_NAV_REQUEST_SERVICE_INTEGRATION ([MS_YEU_CAU],[GL_ACC],[MO_TA_SERVICE],[SER_GROUP_CODE],[SO_LUONG],
				[MS_CONG_NHAN],[NGAY_YEU_CAU],[MS_PHIEU_BAO_TRI],[MS_BP_CHIU_PHI],[AMOUNT],[VENDOR_CODE],
				INSERT_DATE ,UPDATE_DATE ,[STATUS]	,DA_CHUYEN ,NGAY_CHUYEN,STT_SYN)
		VALUES( @MS_YEU_CAU,@GL_ACC,@MO_TA_SERVICE,@SER_GROUP_CODE,@SO_LUONG,
				@MS_CONG_NHAN,@NGAY_YEU_CAU_CV,@MS_PHIEU_BAO_TRI,@MS_BP_CHIU_PHI,@AMOUNT,@VENDOR_CODE,
				@INSERT_DATE ,@UPDATE_DATE ,@STATUS,@DA_CHUYEN ,@NGAY_CHUYEN,@STT)
END					
     